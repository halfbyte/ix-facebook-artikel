!!!
%html{html_attrs}
  %head
    %title Facebook Test
    %meta(http-eqiv="Content-Type" content="text/html; charset=UTF-8")
    %script(src="/javascripts/jquery-1.4.2.min.js" type="text/javascript")
  %body
    %h1 Facebook for Websites Testbed
    
    #room-for-infos
    
    - if @access_token
          
      Hi, 
      %span#user-name -LOADING-

      %h2 Here's your data:
      
      %pre
        = @graph.to_yaml
      
      %dl
      - @graph.each do |k, v|
        %dt= k
        %dd= v
      - if @friends
        %h2 Here's your friends
        %ul
        - @friends['data'].each do |friend|
          %li= friend['name']
          
    %div
      %fb:login-button(perms="email,user_birthday" show-faces="true")
      
    %div
      %fb:facepile

    %div
      %fb:like(href="http://headflash.com:4567/" layout="standard" show_faces="true" width="450" action="like" colorscheme="light")

    

    %div#fb-root
      :javascript

        var fbSession = null;

        window.fbAsyncInit = function() {
          FB.init({appId: '#{@app_id}', status: true, cookie: true,
                   xfbml: true});
          FB.Event.subscribe('auth.login', function(response) {
            window.location.reload();
          });
          
          
          FB.getLoginStatus(function(response) {
            if (response.session) {
              FB.api('/me', function(response) {
                $('#user-name').html(response.name);
              });
            } 
          });
          
        };
        (function() {
          var e = document.createElement('script'); e.async = true;
          e.src = document.location.protocol +
            '//connect.facebook.net/en_US/all.js';
          document.getElementById('fb-root').appendChild(e);
        }());
